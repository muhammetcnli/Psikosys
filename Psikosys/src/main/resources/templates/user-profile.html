<!DOCTYPE html>
<html th:lang="${currentLang != null ? currentLang : 'tr'}" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${currentLang == 'en' ? 'Profile â€“ Psikosys' : 'Profil â€“ Psikosys'}">Profil â€“ Psikosys</title>
    <link rel="shortcut icon" th:href="@{/images/favicon.ico}" type="image/x-icon">
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="profile-body">
<div class="profile-container">
    <!-- Header -->
    <header class="profile-header">
        <div class="header-content">
            <a href="/chat" class="back-button">
                <i class="fas fa-arrow-left"></i>
                <span th:text="${currentLang == 'en' ? 'Back to Chat' : 'Sohbete DÃ¶n'}">Sohbete DÃ¶n</span>
            </a>
            <h1 class="profile-title" th:text="${currentLang == 'en' ? 'Profile Settings' : 'Profil AyarlarÄ±'}">Profil AyarlarÄ±</h1>
            <form method="post" action="/logout" class="logout-form">
                <button type="submit" class="logout-button">
                    <i class="fas fa-sign-out-alt"></i>
                    <span th:text="${currentLang == 'en' ? 'Logout' : 'Ã‡Ä±kÄ±ÅŸ'}">Ã‡Ä±kÄ±ÅŸ</span>
                </button>
            </form>
        </div>
    </header>

    <!-- Main Content -->
    <main class="profile-main">
        <div class="profile-grid">
            <!-- Profile Info Card -->
            <div class="profile-card">
                <div class="card-header">
                    <i class="fas fa-user-circle"></i>
                    <h2 th:text="${currentLang == 'en' ? 'Profile Information' : 'Profil Bilgileri'}">Profil Bilgileri</h2>
                </div>
                <div class="profile-info">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar">
                            <img th:if="${photo != null && !#strings.isEmpty(photo)}"
                                 th:src="${photo}"
                                 alt="Profile Photo"
                                 class="avatar-image"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div class="avatar-placeholder"
                                 th:style="${(photo != null && !#strings.isEmpty(photo)) ? 'display:none;' : 'display:flex;'}">
                                <i class="fas fa-user"></i>
                            </div>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div class="detail-item">
                            <label th:text="${currentLang == 'en' ? 'Name' : 'Ä°sim'}">Ä°sim</label>
                            <span th:text="${name != null && !#strings.isEmpty(name)} ? ${name} : (${currentLang == 'en'} ? 'Not specified' : 'BelirtilmemiÅŸ')">-</span>
                        </div>
                        <div class="detail-item">
                            <label th:text="${currentLang == 'en' ? 'Email' : 'E-posta'}">E-posta</label>
                            <span th:text="${email != null && !#strings.isEmpty(email)} ? ${email} : (${currentLang == 'en'} ? 'Not specified' : 'BelirtilmemiÅŸ')">-</span>
                        </div>
                        <div class="detail-item">
                            <label th:text="${currentLang == 'en' ? 'Account Type' : 'Hesap TÃ¼rÃ¼'}">Hesap TÃ¼rÃ¼</label>
                            <div class="account-type">
                                <i th:class="${hasPassword} ? 'fas fa-key' : 'fab fa-google'"></i>
                                <span th:text="${hasPassword} ? (${currentLang == 'en'} ? 'Local Account' : 'Yerel Hesap') : (${currentLang == 'en'} ? 'Google Account' : 'Google HesabÄ±')">-</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Language Settings Card -->
            <div class="settings-card">
                <div class="card-header">
                    <i class="fas fa-language"></i>
                    <h2 th:text="${currentLang == 'en' ? 'Language Settings' : 'Dil AyarlarÄ±'}">Dil AyarlarÄ±</h2>
                </div>
                <form id="languageForm" th:action="@{/profile/language}" method="post" class="settings-form">
                    <div class="form-group">
                        <label for="languageSelect" th:text="${currentLang == 'en' ? 'Preferred Language' : 'Tercih Edilen Dil'}">Tercih Edilen Dil</label>
                        <div class="select-wrapper">
                            <select id="languageSelect" name="language" class="form-select">
                                <option value="tr" th:selected="${currentLang == 'tr'}">ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</option>
                                <option value="en" th:selected="${currentLang == 'en'}">ðŸ‡¬ðŸ‡§ English</option>
                            </select>
                            <i class="fas fa-chevron-down select-icon"></i>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        <span th:text="${currentLang == 'en' ? 'Save Language' : 'Dili Kaydet'}">Dili Kaydet</span>
                    </button>
                </form>
            </div>

            <!-- Password Settings Card -->
            <div th:if="${hasPassword or showPasswordForm}" class="settings-card password-card">
                <div class="card-header">
                    <i class="fas fa-lock"></i>
                    <h2 th:text="${hasPassword ? (currentLang == 'en' ? 'Change Password' : 'Åžifre DeÄŸiÅŸtir') : (currentLang == 'en' ? 'Set Password' : 'Åžifre Belirle')}">Åžifre AyarlarÄ±</h2>
                </div>
                <div th:if="not ${hasPassword}" class="card-description">
                    <p th:text="${currentLang == 'en' ? 'Set a password to secure your account and enable local login' : 'HesabÄ±nÄ±zÄ± gÃ¼vence altÄ±na almak ve yerel giriÅŸ yapmak iÃ§in ÅŸifre belirleyin'}"></p>
                </div>
                <form id="passwordForm" th:action="@{/profile/password}" method="post" class="settings-form">
                    <div th:if="${hasPassword}" class="form-group">
                        <label for="currentPassword" th:text="${currentLang == 'en' ? 'Current Password' : 'Mevcut Åžifre'}">Mevcut Åžifre</label>
                        <div class="input-wrapper">
                            <input type="password"
                                   id="currentPassword"
                                   name="currentPassword"
                                   class="form-input"
                                   required
                                   autocomplete="current-password"
                                   th:placeholder="${currentLang == 'en' ? 'Enter current password' : 'Mevcut ÅŸifrenizi girin'}">
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="newPassword" th:text="${hasPassword} ? (${currentLang == 'en'} ? 'New Password' : 'Yeni Åžifre') : (${currentLang == 'en'} ? 'Password' : 'Åžifre')">Yeni Åžifre</label>
                        <div class="input-wrapper">
                            <input type="password"
                                   id="newPassword"
                                   name="newPassword"
                                   class="form-input"
                                   required
                                   minlength="6"
                                   autocomplete="new-password"
                                   th:placeholder="${currentLang == 'en' ? 'Enter new password (min 6 characters)' : 'Yeni ÅŸifrenizi girin (en az 6 karakter)'}">
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                        <div class="password-strength">
                            <div class="strength-bar">
                                <div class="strength-fill"></div>
                            </div>
                            <span class="strength-text" th:text="${currentLang == 'en' ? 'Password strength will be shown here' : 'Åžifre gÃ¼cÃ¼ burada gÃ¶sterilecek'}">Åžifre gÃ¼cÃ¼ burada gÃ¶sterilecek</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword" th:text="${currentLang == 'en' ? 'Confirm Password' : 'Åžifre Tekrar'}">Åžifre Tekrar</label>
                        <div class="input-wrapper">
                            <input type="password"
                                   id="confirmPassword"
                                   name="confirmPassword"
                                   class="form-input"
                                   required
                                   autocomplete="new-password"
                                   th:placeholder="${currentLang == 'en' ? 'Confirm your password' : 'Åžifrenizi tekrar girin'}">
                            <i class="fas fa-eye-slash toggle-password"></i>
                        </div>
                        <div class="password-match-indicator">
                            <i class="fas fa-check"></i>
                            <span th:text="${currentLang == 'en' ? 'Passwords match' : 'Åžifreler eÅŸleÅŸiyor'}">Åžifreler eÅŸleÅŸiyor</span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-key"></i>
                        <span th:text="${hasPassword} ? (${currentLang == 'en'} ? 'Change Password' : 'Åžifreyi DeÄŸiÅŸtir') : (${currentLang == 'en'} ? 'Set Password' : 'Åžifreyi Belirle')">Åžifreyi Kaydet</span>
                    </button>
                </form>
            </div>

            <!-- Google hesap iÃ§in ÅŸifre belirleme -->
            <div th:if="${not hasPassword and not showPasswordForm}" class="settings-card">
                <div class="card-header">
                    <i class="fas fa-shield-alt"></i>
                    <h2 th:text="${currentLang == 'en' ? 'Security Settings' : 'GÃ¼venlik AyarlarÄ±'}">GÃ¼venlik AyarlarÄ±</h2>
                </div>
                <div class="card-description">
                    <p th:text="${currentLang == 'en' ? 'Your account is secured with Google. You can optionally set a password for local login.' : 'HesabÄ±nÄ±z Google ile gÃ¼vence altÄ±nda. Ä°steÄŸe baÄŸlÄ± olarak yerel giriÅŸ iÃ§in ÅŸifre belirleyebilirsiniz.'}"></p>
                </div>
                <a href="/profile?showPasswordForm=true" class="btn btn-secondary">
                    <i class="fas fa-plus"></i>
                    <span th:text="${currentLang == 'en' ? 'Set Password' : 'Åžifre Belirle'}">Åžifre Belirle</span>
                </a>
            </div>
        </div>

        <!-- Mesajlar -->
        <div th:if="${success} or ${error}" class="messages-container">
            <div th:if="${success}" class="alert alert-success">
                <i class="fas fa-check-circle"></i>
                <span th:text="${success}"></span>
            </div>
            <div th:if="${error}" class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <span th:text="${error}"></span>
            </div>
        </div>
    </main>
</div>
<script th:src="@{/js/profile.js}"></script>
</body>
</html>